# Memory Log - 2026-02-04

## Build 4: 3-Tier Anthropic Model Consolidation (6:03 PM EST)

**Goal:** Eliminate Gemini Flash and OpenAI Mini dependencies. Consolidate to pure Anthropic 3-tier model routing (Opus/Sonnet/Haiku).

**What Changed:**
- Deleted 3 cron jobs using OpenAI Mini (gpt-4o-mini)
- Recreated them using Anthropic Haiku (claude-haiku-4-5-20251001)

**Deleted:**
- email-monitor (was openai/gpt-4o-mini)
- git-autocommit (was openai/gpt-4o-mini)
- memory-archive (was openai/gpt-4o-mini)

**Recreated with Haiku:**
- email-monitor (*/5 min) — Explicit gog gmail search command, priority scoring
- git-autocommit (*/30 min) — Silent git operations
- memory-archive (1st of month, 3 AM) — Silent archival

**Verified Sonnet Jobs Still Correct:**
- task-worker (anthropic/claude-sonnet-4-5-20250929) ✅
- war-room-competitors (anthropic/claude-sonnet-4-5-20250929) ✅
- war-room-cms (anthropic/claude-sonnet-4-5-20250929) ✅
- war-room-industry (anthropic/claude-sonnet-4-5-20250929) ✅
- morning-briefing (anthropic/claude-sonnet-4-5-20250929) ✅
- memory-consolidation (anthropic/claude-sonnet-4-5-20250929) ✅

**Final State:**
- 10 total cron jobs
- 3 on Haiku (lightweight: email, git, archive)
- 6 on Sonnet (heavy work: tasks, war room, briefing, consolidation)
- 1 on default (Daily Auto-Update - left as-is)

**Why This Matters:**
- Pure Anthropic stack = OAuth-only auth (more secure, no API keys)
- No external provider dependencies (Gemini/OpenAI)
- Haiku is cheaper than Mini for simple tasks
- All models from same provider = consistent behavior

**Cost Impact:**
- Haiku ~$0.80/M input vs Mini ~$0.15/M
- But Haiku is faster and more reliable for simple tasks
- Overall monthly cost similar or slightly lower due to consistency

**Next:** AGENTS.md needs update with new 3-tier routing rules.

## Build 4 Hotfix: Corrected Haiku Model String (6:06 PM EST)

**Issue:** First attempt used wrong model string: `anthropic/claude-haiku-4-5-20251001` (doesn't exist in config)
**Error:** `model not allowed: anthropic/claude-haiku-4-5-20251001`
**Fix:** Deleted and recreated 3 jobs with correct model: `anthropic/claude-haiku-3-5`

**Corrected Jobs:**
- email-monitor: 29e858c1-25d9-4ef0-8145-d4163c03cbeb (anthropic/claude-haiku-3-5) ✅
- git-autocommit: ecd31f91-3433-4f63-b2ab-64746c1f9535 (anthropic/claude-haiku-3-5) ✅
- memory-archive: a6a4c724-268a-4ef0-a0a3-51cc3a108ee6 (anthropic/claude-haiku-3-5) ✅

**Verification:** `openclaw cron list` shows all 10 jobs active, next email-monitor run in 3 minutes.

**Lesson:** Always verify model strings against config before creating cron jobs. The available Haiku model is `claude-haiku-3-5`, not `claude-haiku-4-5`.

## Build 4.1: Native Multi-Model Routing (6:24 PM EST)

**Goal:** Configure native multi-model routing in openclaw.json so platform handles model selection automatically instead of manually specifying models in each cron job.

**Config Changes:**
- `agents.defaults.model.primary` → `anthropic/claude-sonnet-4-5-20250929` (Sonnet - main sessions)
- `agents.defaults.model.fallbacks` → `["anthropic/claude-haiku-4-5-20251001"]` (Haiku fallback only)
- `agents.defaults.models` → Pure Anthropic 3-tier:
  - `anthropic/claude-opus-4-5-20251101` (alias: opus)
  - `anthropic/claude-sonnet-4-5-20250929` (alias: sonnet)
  - `anthropic/claude-haiku-4-5-20251001` (alias: haiku)
- `agents.defaults.heartbeat.model` → `anthropic/claude-haiku-4-5-20251001` (Haiku handles heartbeats)
- `agents.defaults.subagents.model` → `anthropic/claude-haiku-4-5-20251001` (Haiku handles sub-agents)
- `agents.defaults.subagents.maxConcurrent` → `1` (limit concurrent sub-agents)
- `agents.defaults.subagents.archiveAfterMinutes` → `60` (auto-archive after 1 hour)

**Removed Models:**
- ❌ `openai/gpt-4o-mini` (Mini)
- ❌ `google/gemini-1.5-flash` (Flash)
- ❌ `amazon-bedrock/global.anthropic.claude-sonnet-4-5-20250929-v1:0` (Bedrock)
- ❌ `anthropic/claude-3-5-sonnet-20241022` (old Sonnet)

**Why This Matters:**
- Sonnet is primary model for all main sessions
- Haiku handles heartbeats and sub-agents automatically via platform routing
- Opus available on-demand via command (`/model opus`)
- Eliminated need for agent-level model selection logic — platform handles routing natively
- All 3 tiers are Anthropic-only (no Gemini/OpenAI dependencies)

**Next:** Restart OpenClaw to pick up new config.
